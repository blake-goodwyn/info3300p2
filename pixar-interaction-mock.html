<html>
<head>
	<link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
	<style>
	rect.bar { 
		fill: #4169e1; 
	}
	path{
		fill: none;
		stroke: #000000;
		stroke-width: 2;
	}
	.axis {
		font-size: 14;
	}
	body{
		font-size: 20;
		font-family: 'Lato', sans-serif;
		background: #dddfd4;
	}
	circle{
		stroke-width: 3;
	}
	</style>
<script>
	//Reference Data
	var pixarData = [  
		   {"movie":"Toy Story",
		   "data":{  
		      "votes":{
		         "text":"601406"
		      },
		      "rating":{
		         "text":"8.3"
		      },
		      "runtimes":{
		         "item":[  
		            "81",
		            {  
		               "notes":"(TV version)",
		               "text":"Turkey:74"
		            }
		         ]
		      },
		      "year":{
		         "text":"1995"
		      },
		      "director":{
		         "person":{
		            "name":"John Lasseter"
		         }
		      },
		      "cover": {
		      	"url": "http://ia.media-imdb.com/images/M/MV5BMTgwMjI4MzU5N15BMl5BanBnXkFtZTcwMTMyNTk3OA@@._V1._SX100_SY133_.jpg",
		      		"w": 100,
		      		"h": 113
		      }
		   }},

		   {"movie":"A Bug's Life",
		   "data":{  
		      "votes":{
		         "text":"205852"
		      },
		      "rating":{
		         "text":"7.2"
		      },
		      "runtimes":{
		         "item":"95"
		      },
		      "year":{
		         "text":"1998"
		      },
		      "director":{
		         "person":[  
		            {
		               "name":"John Lasseter"
		            },
		            {
		               "name":"Andrew Stanton",
		               "notes":"(co-director)"
		            }
		         ]
		      },
		      "cover": {
		      	"url": "http://ia.media-imdb.com/images/M/MV5BMTI5NTc1NjU2NF5BMl5BanBnXkFtZTcwNzkyNDAyMQ@@._V1._SX98_SY140_.jpg",
		      		"w": 98,
		      		"h": 139
		      }
		   }},

		   {"movie":"Toy Story 2",
		   "data":{  
		         "votes":{
		            "text":"374050"
		         },
		         "rating":{
		            "text":"7.9"
		         },
		         "runtimes":{
		            "item":[  
		               "92",
		               {  
		                  "notes":"(TV version)",
		                  "text":"Turkey:82"
		               }
		            ]
		         },
		         "year":{
		            "text":"1999"
		         },
		         "director":{
		            "person":[  
		               {
		                  "name":"John Lasseter"
		               },
		               {
		                  "name":"Ash Brannon",
		                  "notes":"(co-director)"
		               },
		               {
		                  "name":"Lee Unkrich",
		                  "notes":"(co-director)"
		               }
		            ]
		         },
		         "cover": {
		         	"url": "http://ia.media-imdb.com/images/M/MV5BMTQ0OTU0NTcyNl5BMl5BanBnXkFtZTcwOTk5Mjc4OA@@._V1._SX100_SY133_.jpg",
		      		"w": 98,
		      		"h": 139
		      	}
		      }},

		      {"movie":"Monsters, Inc.",
		  		"data":{
		  			"votes": {
		  				"text": "563876"
		  			},
		  			"rating": {
		  				"text": "8.1"
		  			},
		  			"runtimes": { 
		  				"item": "92"
		  			},
		  			"year": {
		  				"text": "2001"
		  			},
		  			"director": { 
		  				"person": [
		  					{
		  						"name": "Pete Docter"
		  					}, 
		  					{
		  						"name": "David Silverman", 
		  						"notes": "(co-director)"
		  					}, 
		  					{
		  						"name": "Lee Unkrich", 
		  						"notes": "(co-director)"
		  					}
		  				]
		  			},
		  			"cover": {
		  				"url": "http://ia.media-imdb.com/images/M/MV5BMTY1NTI0ODUyOF5BMl5BanBnXkFtZTgwNTEyNjQ0MDE@._V1._SX94_SY140_.jpg",
			      		"w": 94,
			      		"h": 139
			      	}
		  		}},

				{"movie":"Finding Nemo",
				 "data":{
				 	"votes": {
				 		"text": "663881"
				 	},
				 	"rating": {
				 		"text": "8.1"
				 	},
				 	"runtimes": {
				 		"item": "100"
				 	},
				 	"year": {
				 		"text": "2003"
				 	},
				 	"director": { 
				 		"person": [
				 			{
				 				"name": "Andrew Stanton"
				 			}, 
				 			{ 
				 				"name": "Lee Unkrich", 
				 				"notes": "(co-director)"
				 			}
				 		]
				 	},
			      "cover": {
			      	"url": "http://ia.media-imdb.com/images/M/MV5BMTY1MTg1NDAxOV5BMl5BanBnXkFtZTcwMjg1MDI5Nw@@._V1._SX95_SY140_.jpg",
			      		"w": 94,
			      		"h": 140
			      	}
				 }},

				 {"movie":"The Incredibles",
				 "data":{
				 	"votes": {
				 		"text": "464419"
				 	},
					"rating": {
						"text": "8.0"
					},
					"runtimes": {
						"item": "115"
					},
					"year": {
						"text": "2004"
					},
					"director": {
						"person": { 
							"name": "Brad Bird"
						}
					},
					"cover": {
						"url": "http://ia.media-imdb.com/images/M/MV5BMTY5OTU0OTc2NV5BMl5BanBnXkFtZTcwMzU4MDcyMQ@@._V1._SX95_SY140_.jpg",
			      		"w": 94,
			      		"h": 140
			      	}

				 }},

				 {"movie":"Cars",
				 "data":{
				 	"votes": {
				 		"text": "253912"
				 	},
					"rating": {
						"text": "7.2"
					},
					"runtimes": {
						"item": "117"
					},
					"year": {
						"text": "2006"
					},
					"director": { 
						"person": [
							{ 
								"name": "John Lasseter"
							}, 
							{ 
								"name": "Joe Ranft", 
								"notes": "(co-director)"
							}
						]
					},
					"cover": {
						"url": "http://ia.media-imdb.com/images/M/MV5BMTg5NzY0MzA2MV5BMl5BanBnXkFtZTYwNDc3NTc2._V1._SX94_SY140_.jpg",
			      		"w": 94,
			      		"h": 140
			      	}
				 }},

				 {"movie":"Ratatouille",
				 "data":{
				 	"votes": {
				 		"text": "459217"
				 	},
					"rating": { 
						"text": "8.0"
					},
					"runtimes": {
						"item": "111"
					},
					"year": {
						"text": "2007"
					},
					"director": { 
						"person": [
							{ 
								"name": "Brad Bird"
							}, 
							{
								"name": "Jan Pinkava", 
								"notes": "(co-director)"
							}
						]
					},
					"cover": {
						"url": "http://ia.media-imdb.com/images/M/MV5BMTMzODU0NTkxMF5BMl5BanBnXkFtZTcwMjQ4MzMzMw@@._V1._SX94_SY140_.jpg",
			      		"w": 94,
			      		"h": 140
			      	}
				 }},

				 {"movie":"WALL-E",
				 "data":{
				 	"votes": {
				 		"text": "693522"
				 	},
					"rating": {
						"text": "8.4"
					},
					"runtimes": {
						"item": "98"
					},
					"year": {
						"text": "2008"
					},
					"director": {
						"person": {
							"name": "Andrew Stanton"
						}
					},
					"cover": {
						"url": "http://ia.media-imdb.com/images/M/MV5BMTczOTA3MzY2N15BMl5BanBnXkFtZTcwOTYwNjE2MQ@@._V1._SX95_SY140_.jpg",
			      		"w": 94,
			      		"h": 140
			      	}
				 }},

				 {"movie":"Up",
				 "data":{
				 	"votes": {
				 		"text": "640595"
				 	},
					"rating": {
						"text": "8.3"
					},
					"runtimes": { 
						"item": "96"
					},
					"year": {
						"text": "2009"
					},
					"director": {
						"person": [
							{ 
								"name": "Pete Docter"
							}, 
							{
								"name": "Bob Peterson", 
								"notes": "(co-director)"
							}
						]
					},
					"cover": {
						"url": "http://ia.media-imdb.com/images/M/MV5BMTk3NDE2NzI4NF5BMl5BanBnXkFtZTgwNzE1MzEyMTE@._V1._SX93_SY140_.jpg",
			      		"w": 94,
			      		"h": 140
			      	}
				 }},

				 {"movie":"Toy Story 3",
				 "data":{
				 	"votes": { 
				 		"text": "526019"
				 	},
					"rating": {
						"text": "8.3"
					},
					"runtimes": {
						"item": "103"
					},
					"year": {
						"text": "2010"
					},
					"director": { 
						"person": { 
							"name": "Lee Unkrich"
						}
					},
					"cover": {
						"url": "http://ia.media-imdb.com/images/M/MV5BMTgxOTY4Mjc0MF5BMl5BanBnXkFtZTcwNTA4MDQyMw@@._V1._SX99_SY140_.jpg",
			      		"w": 94,
			      		"h": 140
			      	}
				 }},

				{"movie":"Cars 2",
				 "data":{
				 	"votes": {
				 		"text": "97797"
				 	},
					"rating": {
						"text": "6.3"
					},
					"runtimes": { 
						"item": "USA:106"
					},
					"year": {
						"text": "2011"
					},
					"director": {
						"person": [
							{ 
								"name": "John Lasseter"
							}, 
							{ 
								"name": "Brad Lewis", 
								"notes": "(co-director)"
							}
						]
					},
					"cover": {
						"url": "http://ia.media-imdb.com/images/M/MV5BMTUzNTc3MTU3M15BMl5BanBnXkFtZTcwMzIxNTc3NA@@._V1._SX94_SY140_.jpg",
			      		"w": 94,
			      		"h": 140
			      	}
				 }},

				{"movie":"Brave",
				 "data":{
				 	"votes": {
				 		"text": "266304"
				 	},
					"rating": { 
						"text": "7.2"
					},
					"runtimes": {
						"item": "93"
					},
					"year": {
						"text": "2012"
					},
					"director": { 
						"person": [
							{ 
								"name": "Mark Andrews"
							}, 
							{
								"name": "Brenda Chapman"
							}, 
							{
								"name": "Steve Purcell", 
								"notes": "(co-director)"
							}
						]
					},
					"cover": {
						"url": "http://ia.media-imdb.com/images/M/MV5BMzgwODk3ODA1NF5BMl5BanBnXkFtZTcwNjU3NjQ0Nw@@._V1._SX95_SY140_.jpg",
			      		"w": 94,
			      		"h": 140
			      	}
				 }},

				 {"movie":"Monsters University",
				 "data":{
				 	"votes": { 
				 		"text": "226373"
				 	},
					"rating": { 
						"text": "7.4"
					},
					"runtimes": { 
						"item": "104"
					},
					"year": {
						"text": "2013"
					},
					"director": {
						"person": {
							"name": "Dan Scanlon"
						}
					},
					"cover": {
						"url": "http://ia.media-imdb.com/images/M/MV5BMTUyODgwMDU3M15BMl5BanBnXkFtZTcwOTM4MjcxOQ@@._V1._SX94_SY140_.jpg",
			      		"w": 94,
			      		"h": 140
			      	}
				 }}					 				 

		   ]

	var sonyData = [
		{"movie": "Skyfall", 
		"data": {
			"votes": {
				"text": "510149"
			}, 
			"rating": {
				"text": "7.8"
			},
			"runtimes": { 
				"item": "143"
			}, 
			"year": {
				"text": "2012"
			},
			"director": {
				"person": {
					"name": "Sam Mendes"
				}
			},
			"cover": {
				"url": "http://ia.media-imdb.com/images/M/MV5BMjAyODkzNDgzMF5BMl5BanBnXkFtZTcwMDMxMDI4Nw@@._V1._SX94_SY140_.jpg",
				"w": 94,
				"h": 140
			}
		}},

		{"movie": "Spider-Man 3", 
		"data": {
			"votes": {
				"text": "371855"
			},
			"rating": { 
				"text": "6.2"
			},
			"runtimes": {
				"item": [
					"139", 
					{
						"notes": "(director's cut)", 
						"text": "156"
					}
				]
			}, 
			"year": {
				"text": "2007"
			},
			"director": {
				"person": {
					"name": "Sam Raimi"
				}
			}, 
			"cover": {
				"url": "http://ia.media-imdb.com/images/M/MV5BODUwMDc5Mzc5M15BMl5BanBnXkFtZTcwNDgzOTY0MQ@@._V1._SX94_SY140_.jpg",
				"w": 94,
				"h": 140
			}
		}},

		{"movie": "Spectre", 
		"data": {
			"votes": {
				"text": "252623"
			}, 
			"rating": {
				"text": "6.9"
			},
			"runtimes": {
				"item": "148"
			}, 
			"year": {
				"text": "2015"
			},
			"director": {
				"person": {
					"name": "Sam Mendes"
				}
			},
			"cover": {
				"url": "http://ia.media-imdb.com/images/M/MV5BMjM2Nzg4MzkwOF5BMl5BanBnXkFtZTgwNzA0OTE3NjE@._V1._SX94_SY140_.jpg",
				"w": 94,
				"h": 140
			}
		}},

		{"movie": "Spider-Man", 
		"data": {
			"votes": {
				"text": "530769"
			},
			"rating": { 
				"text": "7.3"
			},
			"runtimes": {
				"item": "121"
			},
			"year": {
				"text": "2002"
			}, 
			"director": {
				"person": {
					"name": "Sam Raimi"
				}
			}, 
			"cover": {
				"url": "http://ia.media-imdb.com/images/M/MV5BMzk3MTE5MDU5NV5BMl5BanBnXkFtZTYwMjY3NTY3._V1._SX95_SY140_.jpg",
				"w": 94,
				"h": 140
			}
		}},

		{"movie": "Spider-Man 2", 
		"data": {
			"votes": {
				"text": "397980"
			}, 
			"rating": {
				"text": "7.3"
			},
			"runtimes": {
				"item": [
					"127", 
					{
						"notes": "(DVD extended cut)", 
						"text": "USA:135"
					}
				]
			},
			"year": { 
				"text": "2004"
			},
			"director": {
				"person": {
					"name": "Sam Raimi"
				}
			}, 
			"cover": { 
				"url": "http://ia.media-imdb.com/images/M/MV5BMjE0Njc1NDYzN15BMl5BanBnXkFtZTcwNjAxMzYyMQ@@._V1._SX94_SY140_.jpg",
				"w": 94,
				"h": 140
			}
		}},

		// {"movie": "2012", 
		// "data": {
		// 	"votes": {
		// 		"text": "276130"
		// 	}, 
		// 	"rating": {
		// 		"text": "5.8"
		// 	},
		// 	"runtimes": { 
		// 		"item": "158"
		// 	}, 
		// 	"year": {
		// 		"text": "2009"
		// 	},
		// 	"director": {
		// 		"person": {
		// 			"name": "Roland Emmerich"
		// 		}
		// 	}, 
		// 	"cover": {
		// 		"url": "http://ia.media-imdb.com/images/M/MV5BMTY0MjEyODQzMF5BMl5BanBnXkFtZTcwMTczMjQ4Mg@@._V1._SX94_SY140_.jpg",
		// 		"w": 94,
		// 		"h": 140
		// 	}
		// }},

		{"movie": "The Da Vinci Code", 
		"data": {
			"votes": {
				"text": "307053"
			}, 
			"rating": { 
				"text": "6.5"
			},
			"runtimes": {
				"item": [
					"149", 
					{
						"notes": "(extended cut)", 
						"text": "174"
					}
				]
			},
			"year": {
				"text": "2006"
			},
			"director": {
				"person": {
					"name": "Ron Howard"
				}
			},
			"cover": { 
				"url": "http://ia.media-imdb.com/images/M/MV5BMjIxMjQyMTc3Nl5BMl5BanBnXkFtZTcwMTA1MDUzMw@@._V1._SX94_SY140_.jpg",
				"w": 94,
				"h": 140
			}
		}},

		{"movie": "The Amazing Spider-Man", 
		"data": {
			"votes": {
				"text": "440293"
			}, 
			"rating": {
				"text": "7.0"
			},
			"runtimes": {
				"item": [
					"136", 
					{
						"notes": "(Extended Cut)", 
						"text": "153"
					}
				]
			}, 
			"year": {
				"text": "2012"
			},
			"director": {
				"person": { 
					"name": "Marc Webb"
				}
			}, 
			"cover": {
				"url": "http://ia.media-imdb.com/images/M/MV5BMjMyOTM4MDMxNV5BMl5BanBnXkFtZTcwNjIyNzExOA@@._V1._SX94_SY140_.jpg",
				"w": 94,
				"h": 140
			}
		}},

		{"movie": "The Amazing Spider-Man 2", 
		"data": {
			"votes": {
				"text": "310625"
			}, 
			"rating": {
				"text": "6.8"
			},
			"runtimes": {
				"item": "142"
			},
			"year": {
				"text": "2014"
			},
			"director": {
				"person": {
					"name": "Marc Webb"
				}
			},
			"cover": {
				"url": "http://ia.media-imdb.com/images/M/MV5BOTA5NDYxNTg0OV5BMl5BanBnXkFtZTgwODE5NzU1MTE@._V1._SX94_SY140_.jpg",
				"w": 94,
				"h": 140
			}
		}},

		{"movie": "Hancock", 
		"data": {
			"votes": {
				"text": "333677"
			},
			"rating": {
				"text": "6.4"
			},
			"runtimes": { 
				"item": [
					"92", 
					{
						"notes": "(unrated version)", 
						"text": "USA:102"
					}
				]
			}, 
			"year": {
				"text": "2008"
			},
			"director": {
				"person": {
					"name": "Peter Berg"
				}
			}, 
			"cover": {
				"url": "http://ia.media-imdb.com/images/M/MV5BMTgyMzc4ODU3NV5BMl5BanBnXkFtZTcwNjk5Mzc1MQ@@._V1._SX94_SY140_.jpg",
				"w": 94,
				"h": 140
			}
		}},

		{"movie": "Men in Black 3", 
		"data": {
			"votes": {
				"text": "261778"
			},
			"rating": {
				"text": "6.8"
			},
			"runtimes": { 
				"item": "USA:106"
			}, 
			"year": {
				"text": "2012"
			},
			"director": {
				"person": {
					"name": "Barry Sonnenfeld"
				}
			},
			"cover": {
				"url": "http://ia.media-imdb.com/images/M/MV5BMTU2NTYxODcwMF5BMl5BanBnXkFtZTcwNDk1NDY0Nw@@._V1._SX94_SY140_.jpg",
				"w": 94,
				"h": 140
			}
		}},

		{"movie": "Casino Royale", 
		"data": {
			"votes": {
				"text": "459248"
			}, 
			"rating": {
				"text": "8.0"
			},
			"runtimes": {
				"item": "144"
			}, 
			"year": { 
				"text": "2006"
			},
			"director": {
				"person": {
					"name": "Martin Campbell"
				}
			},
			"cover": {
				"url": "http://ia.media-imdb.com/images/M/MV5BMTM5MjI4NDExNF5BMl5BanBnXkFtZTcwMDM1MjMzMQ@@._V1._SX94_SY140_.jpg",
				"w": 94,
				"h": 140
			}
		}},

		{"movie": "Men in Black", 
		"data": {
			"votes": {
				"text": "392579"
			}, 
			"rating": {
				"text": "7.3"
			},
			"runtimes": {
				"item": "98"
			},
			"year": { 
				"text": "1997"
			},
			"director": {
				"person": { 
					"name": "Barry Sonnenfeld"
				}
			}, 
			"cover": {
				"url": "http://ia.media-imdb.com/images/M/MV5BNzA2MzI5Nzc0N15BMl5BanBnXkFtZTcwODE2NDU2MQ@@._V1._SX96_SY140_.jpg",
				"w": 94, 
				"h": 140
			}
		}},

		{"movie": "Quantum of Solace", 
		"data": {
			"votes": {
				"text": "322703"
			}, 
			"rating": {
				"text": "6.7"
			},
			"runtimes": {
				"item": "106"
			}, 
			"year": {
				"text": "2008"
			},
			"director": {
				"person": { 
					"name": "Marc Forster"
				}
			}, 
			"cover": { 
				"url": "http://ia.media-imdb.com/images/M/MV5BMTY0MjI4MDI5MF5BMl5BanBnXkFtZTcwODkwNjk3MQ@@._V1._SX95_SY140_.jpg",
				"w": 94,
				"h": 140
			}
		}}
	]
</script>
<script src="//d3js.org/d3.v3.min.js"></script>
</head>
<body>
	<div id="test" align="center"\>
	<script>

	var circleIDArray = [];  //Relates movie IDs to studioData
	
	//Svg initialization
	var l = 850,
		speed = 850,
		radius = l/3;

	var svg = d3.select("#test").append("svg")
		.attr("height", l)
		.attr("width", l)
		.attr("id","overview");

	var yScale = d3.scale.linear().domain([-1,1]).range([(l/2+0.5*radius),(l/2-0.5*radius)])

	//Color scheme
	var colCenter = "#173e43",
		colMovie = "#3fb0ac",
		colText = "#fae596";

	// init(pixarData);
	init(sonyData);

	function init(studioData){

		var cirR = radius/((6/14)*studioData.length); //data circle radius

		//Sorts studio data based on rating
		function compare(a,b){
			if (a.data.rating.text < b.data.rating.text) { return -1 }
			else if (a.data.rating.text > b.data.rating.text) { return 1 }
			else {return 0};
		}

		studioData.sort(compare)

		//Determines path points for startup animation
		function circlePath(radius){
			var points = [],
				n = 1000;
			for (var i = 0; i<n; i++){
				var x = l/2 + radius*Math.cos(i*Math.PI/(n/2)),
					y = l/2 - radius*Math.sin(i*Math.PI/(n/2));
				points.push([x,y]);
			};

			return points
		};

		pathPoints = circlePath(radius);

		//Selects points for data circles
		var specPoints = [],
			step = pathPoints.length/studioData.length;
		for (var i = 0; i<studioData.length; i++){
			specPoints.push(pathPoints[Math.floor(i*step)]);
		};

		specPoints.shift();  //eliminates first point (i.e. spawn circle)

		//Create transition path
		var path = svg.append("path")
			.data([pathPoints])
			.attr("d", d3.svg.line()
			.tension(0) //Catmull-Rom
			.interpolate("cardinal-closed"))
			.style("opacity",0);

		svg.selectAll(".point")
			.data(pathPoints)
			.enter().append("circle")
			.attr("r",4)
			.style("opacity",0)
			.attr("transform", function(d) {return "translate(" + d + ")"});

		//Initialize ID structure
		var c = 65; //Movie ID counter

		//Initialize spawn circle
		var circle = svg.append("circle")
			.attr("r", 0)
			.attr("id", "spwn")
			.style("fill",colMovie)
			.attr("transform", "translate(" + pathPoints[0] + ")")
			.transition()
			.duration(0.5*speed)
			.attr("r", cirR);

		//Begin Transitions		
		console.log("start transition")
		circleTransition(circle);

		function circleTransition(circle) {  //Transition 1 : Loading Animation
			circle.transition() //Initialized #1
			.duration(2.0*speed)
			.attrTween("transform", translateAlong(path.node()))
			.each('end', function(){  //End of Transition 1
				svg.select("#spwn").remove();  //remove spawning circle
				svg.selectAll(".point").remove();  //remove transition points
				svg.append("circle")  //data circle in place of spawn
					.attr({
						r: cirR,
						cx: pathPoints[0][0],
						cy: pathPoints[0][1],
						id: String.fromCharCode(c)
					})
					.style("fill",colMovie);

				circleIDArray.push({"id":String.fromCharCode(c),"ref":null});
				c++;
				fillChange() //Init Transiton 2
			});
		}

		function translateAlong(path) {
			/*Translates spawn circle along specified path and initializes new data circles*/
		  var l = path.getTotalLength();
		  return function(d, i, a) {
		    return function(t) {
		      var p = path.getPointAtLength(t * l);
		      if ((specPoints.length != 0) &&
				((Math.abs(p.x - specPoints[0][0]) < 0.05*l) && (Math.abs(p.y - specPoints[0][1]) < 0.05*l))) { //spawn near specPoint
						var circle = svg.append("circle")
							.attr({
								r: 0,
								cx: specPoints[0][0],
								cy: specPoints[0][1],
								id: String.fromCharCode(c)
							})
							.style("fill",colMovie);

						specPoints.shift();
						circleIDArray.push({"id":String.fromCharCode(c),"ref":null});
						c++;

						circle.transition()
						.attr("r",cirR)
						.delay(0.1*speed)
						.duration(0.5*speed);
				};

		      return "translate(" + p.x + "," + p.y + ")";
		    };
		  };
		};

		function fillChange(array){  //Transition 2 : Center Circle
			var centerCircle = svg.append("circle")  //overview circle
				.attr("r", 0)
				.attr("cx", l/2)
				.attr("cy", l/2)
				.attr("id","center")
				.style("fill", colCenter)
				.transition()  //Initialize Transition Stage 2
				.ease("elastic")
				.duration(1.5*speed)
				.attr("r", 0.5*radius)
				.each('end', function(){  //Transition 3 : Fill Images
					var defs = svg.append('svg:defs');  //container for fill images
					for(var i = 0; i<studioData.length; i++){
						if (!!studioData[i].data.cover){
							var id = studioData[i].movie.replace(/['\s]/g, ''),
								w = studioData[i].data.cover.w,
								h = studioData[i].data.cover.h;

							console.log(id)

							var scale = 2*cirR/w;  //Scaling factor for images 

							var curCircle = svg.select("#" + circleIDArray[i].id);

							circleIDArray[i].ref = studioData[i];

							defs.append("svg:pattern") //reference for specific image
							    .attr("id", id)
							    .attr("width", 1)
							    .attr("height", 1)
								.attr("x", "0")
                        		.attr("y", "0")
							    .append("svg:image")
							    .attr("xlink:href", studioData[i].data.cover.url)
							    .attr("width", w*scale)
							    .attr("height", h*scale)
							    .attr("x", 0)
							    .attr("y", -h/8); //slight image centering

							curCircle.transition() //Image Loading
							.duration(750)
							.style("opacity",0)
							.transition()
							.style("opacity",1)
							.style("fill","url(#" + id +")")
							.style("stroke",colMovie)
							.each('end',interactivity(circleIDArray,id));
						};
					};
					sortFunc();
				});
			};

		function interactivity(array,id){
			//Interactivity
			array.forEach(function(obj){
				var curCircle = svg.select("#"+obj.id);
				curCircle.on("mouseover", function(d,i){

					//Opacity Changes
					array.forEach(function(c){
						if (svg.select("#"+obj.id) != curCircle){
							svg.select("#"+obj.id).style("opacity",0.5);
						}
					});

					//Text Data
					svg.append("text") //title
					.attr("x",l/2)
					.attr("y",yScale(0.5))
					.attr("id",id+"text")
					.style("text-anchor", "middle")
					.style("fill",colText)
					.text(function(d,i){
						return obj.ref.movie;
					});
					
					svg.append("text") //Rating
					.attr("x",l/2)
					.attr("y",yScale(0.35))
					.attr("id",id+"text")
					.style("text-anchor", "middle")
					.style("fill",colText)
					.text(function(d,i){
						return "IMDb Rating: " + obj.ref.data.rating.text;
					})

					svg.append("text") //Rating
					.attr("x",l/2)
					.attr("y",yScale(0.2))
					.attr("id",id+"text")
					.style("text-anchor", "middle")
					.style("fill",colText)
					.text(function(d,i){
						return "Release Year: " + obj.ref.data.year.text;
					})
				})
				.on("mouseout", function(){
					circleIDArray.forEach(function(c){
						svg.select("#"+c.id).style("opacity",1.0);
					});
					svg.selectAll("#"+id+"text").remove();
				});
			});
		};

		function sortFunc(){
			var dropdown = d3.select("#test").append("select").on("change",sortMovies),
				sortParams = ["rating", "year"],
				options = dropdown.selectAll('option').data(sortParams);

			options.enter().append("option").text(function(d){return d;});

			function sortMovies(){
				var idx = dropdown.property('selectedIndex'),
					selection = dropdown[0][0][idx].innerText;
				function compare(a,b){
					if (a.ref.data[selection].text < b.ref.data[selection].text) { return -1 }
					else if (a.ref.data[selection].text > b.ref.data[selection].text) { return 1 }
					else {return 0};
				}
				unsortedArray = circleIDArray.slice();
				circleIDArray.sort(compare);
				newArray = [];
				for (var i = 0; i<unsortedArray.length; i++){
					newArray.push({"id":unsortedArray[i].id,"ref":circleIDArray[i].ref});
				}

				var svg = d3.select("#overview");

				for(var i = 0; i<circleIDArray.length; i++){

					var curCircle = svg.select("#" + unsortedArray[i].id),
						idNew = circleIDArray[i].ref.movie.replace(/['\s]/g, '');

					curCircle.transition() //Image Loading
					.duration(750)
					.style("opacity",0)
					.transition()
					.style("opacity",1)
					.style("fill","url(#" + idNew +")")
					.style("stroke",colMovie)
					.each('end', interactivity(newArray,idNew));
				};
				circleIDArray = newArray;
			};
		};
	};
	</script>
</body>
</html>